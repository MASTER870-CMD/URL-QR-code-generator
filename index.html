




















<!-- 



 

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ultimate TinyURL Clone üöÄ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #ffffff; /* White background as requested */
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 40px 20px;
  color: #000; /* Black text for contrast */
  box-sizing: border-box;
}

/* Keep your original heading size and alignment, but blue color */
h1 {
  margin-bottom: 20px;
  font-size: 2.2rem;
  text-align: center;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.03);
  color: #1e3c72; /* blue heading */
}

/* Inputs: same sizes you used, with blue borders/highlight */
input {
  padding: 14px 16px;
  margin: 10px 0;
  width: 100%;
  max-width: 450px;
  border-radius: 8px;
  border: 2px solid #1e3c72; /* blue border */
  outline: none;
  font-size: 1rem;
  transition: box-shadow 0.3s ease, border-color 0.2s ease;
  box-sizing: border-box;
  background: #fff;
  color: #000;
}

input::placeholder { color: rgba(0,0,0,0.45); }

input:focus {
  box-shadow: 0 0 10px rgba(0, 114, 255, 0.15);
  border-color: #0072ff;
}

/* Buttons: keep your rounded style with blue gradient */
button {
  padding: 14px 30px;
  margin: 12px 5px;
  background: linear-gradient(to right, #00c6ff, #0072ff);
  color: #fff;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  font-size: 1rem;
  position: relative;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  width: 100%;
  max-width: 220px;
}

button::before {
  content: '';
  position: absolute;
  top: 0; left: -75%;
  width: 50%;
  height: 100%;
  background: rgba(255, 255, 255, 0.3);
  transform: skewX(-20deg);
  transition: left 0.5s ease;
}

button:hover::before {
  left: 125%;
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 25px rgba(0,0,0,0.08);
}

/* Result box: white-ish with blue border */
#result {
  margin-top: 30px;
  background: #ffffff;
  color: #000;
  padding: 20px;
  border-radius: 12px;
  width: 100%;
  max-width: 500px;
  text-align: center;
  display: none;
  animation: fadeInUp 0.6s ease forwards;
  word-wrap: break-word;
  border: 2px solid #1e3c72; /* blue border */
}

#qrcode {
  margin-top: 15px;
}

/* History: keep original look but white + blue accents */
#history {
  margin-top: 30px;
  background: #ffffff;
  color: #000;
  padding: 20px;
  border-radius: 12px;
  width: 100%;
  max-width: 500px;
  word-wrap: break-word;
  border: 2px solid rgba(30,60,114,0.08);
}

#history h3 { color: #1e3c72; margin-top: 0; }

#historyList a {
  display: block;
  color: #0072ff;
  text-decoration: none;
  margin: 5px 0;
  transition: color 0.3s;
  word-break: break-all;
}

#historyList a:hover {
  color: #005ec3;
}

/* Error box */
.error {
  background: #ff4e50;
  color: #fff;
  padding: 14px;
  border-radius: 8px;
  margin-top: 10px;
  animation: shake 0.4s;
}

/* Progress bar (subtle blue) */
.progress-bar {
  position: relative;
  width: 100%;
  max-width: 500px;
  height: 5px;
  background: rgba(0, 114, 255, 0.08);
  overflow: hidden;
  border-radius: 5px;
  margin-top: 20px;
}

.progress-bar::before {
  content: '';
  position: absolute;
  left: -40%;
  width: 40%;
  height: 100%;
  background: #00c6ff;
  animation: loading 1.5s linear infinite;
}

/* Keyframes */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}
@keyframes loading {
  0% { left: -40%; }
  100% { left: 100%; }
}

/* Modal (scanner) styles - keep white modal content but dark overlay */
.modal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  align-items: center;
  justify-content: center;
  padding: 20px;
  box-sizing: border-box;
}

.modal-content {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  position: relative;
  width: 100%;
  max-width: 500px;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  background: #0072ff;
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 35px; height: 35px;
  cursor: pointer;
  font-size: 1rem;
}

/* Responsive tweaks (mobile/tablet) while keeping desktop alignment same */
@media (max-width: 900px) {
  body { padding: 24px 16px; }
  h1 { font-size: 1.9rem; }
  input, #result, #history, .modal-content { width: 100%; max-width: 100%; }
  button { width: 100%; max-width: 100%; margin: 8px 0; }
  #qr-reader { width: 100% !important; }
}

@media (max-width: 420px) {
  h1 { font-size: 1.6rem; margin-bottom: 14px; }
  input { padding: 12px 12px; font-size: 0.95rem; }
  button { padding: 12px 16px; font-size: 0.95rem; }
}
  </style>
</head>
<body>
  <h1>üîó Ultimate TinyURL Clone</h1>


  <input type="url" id="longUrl" placeholder="Enter long URL"><br>
  <input type="text" id="customAlias" placeholder="Custom alias (min 5 chars)"><br>

  <button onclick="shortenUrl()">Shorten URL</button>
  <button onclick="openScanner()">Scan QR</button>

  <div id="result"></div>

  <div id="history">
    <h3>üîñ Your Links</h3>
    <ul id="historyList"></ul>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>

  <div id="scannerModal" class="modal" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <button class="close-btn" onclick="closeScanner()">‚úñ</button>
      <div id="qr-reader" style="width: 400px; max-width:100%;"></div>
    </div>
  </div>

  <script>
    
    const apiKey = 'fvTV9xRf9HfXijy4MgMOhR0kCBvyxcd7WLBPCCWPQlPkcxeDBrWoZnqdY0TF';
    let html5QrCode = null;

    document.addEventListener('DOMContentLoaded', () => {
      loadLastResult();
      loadHistory();
    });


    async function shortenUrl() {
      const longUrl = document.getElementById('longUrl').value.trim();
      const customAlias = document.getElementById('customAlias').value.trim();

      if (!longUrl) {
        showError('Please enter a valid URL.');
        return;
      }

      if (customAlias && customAlias.length < 5) {
        showError('Custom alias must be at least 5 characters.');
        return;
      }

      const requestData = { url: longUrl };
      if (customAlias) {
        requestData.domain = 'tiny.one';
        requestData.alias = customAlias;
      }

      showResult('‚è≥ Shortening...');

      try {
        const res = await fetch('https://api.tinyurl.com/create', {
          method: 'POST',
          headers: {
            'accept': 'application/json',
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify(requestData)
        });

        const data = await res.json();

        if (data && data.data && data.data.tiny_url) {
          const shortLink = data.data.tiny_url;
          const linkId = data.data.id_string || null;

          // Save last result (so user sees it after refresh)
          localStorage.setItem('lastShortLink', JSON.stringify({
            url: shortLink,
            id: linkId
          }));

          // Add to history (keep simple array of urls)
          addToHistory(shortLink);

          // Show the result with QR
          showResult(shortLink, linkId);

        } else {
          const msg = (data && data.errors && data.errors.length) ? data.errors[0].message : 'Something went wrong.';
          showError('‚ùå ' + msg);
        }

      } catch (error) {
        console.error(error);
        showError('Request failed.');
      }
    }

    // ===== UI: showResult / showError =====
    function showResult(link, id) {
      const result = document.getElementById('result');
      result.style.display = 'block';

      // If we receive a valid URL, render it with buttons and QR
      if (typeof link === 'string' && link.startsWith('http')) {
        // Clean previous content and create new block
        result.innerHTML = `
          ‚úÖ Short URL: <a href="${link}" target="_blank" rel="noopener">${link}</a><br>
          <button onclick="copyToClipboard('${link}')">üìã Copy</button>
          <div id="qrcode"></div><br>
          <button onclick="deleteLink('${id}')">üóëÔ∏è Delete Link</button>
        `;
        // generate QR (clear first)
        const qrEl = document.getElementById("qrcode");
        if (qrEl) { qrEl.innerHTML = ''; try { new QRCode(qrEl, link); } catch (e) { console.error(e); } }
      } else {
        // for messages like 'Shortening...' or 'Deleting...'
        result.innerHTML = `<div style="color:#333">${link}</div>`;
      }
    }

    function showError(message) {
      const result = document.getElementById('result');
      result.style.display = 'block';
      result.innerHTML = `<div class="error">${message}</div>`;
    }

    // ===== Copy to clipboard =====
    function copyToClipboard(text) {
      if (!navigator.clipboard) {
        alert('Clipboard not supported.');
        return;
      }
      navigator.clipboard.writeText(text).then(() => {
        alert('Copied to clipboard!');
      }).catch(err => {
        console.error(err);
        alert('Copy failed.');
      });
    }

    // ===== Delete link via TinyURL API =====
    async function deleteLink(linkId) {
      if (!linkId) {
        alert('No link ID found to delete.');
        return;
      }

      showResult('‚è≥ Deleting...');

      try {
        const res = await fetch(`https://api.tinyurl.com/delete`, {
          method: 'DELETE',
          headers: {
            'accept': 'application/json',
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({ id: linkId })
        });

        const data = await res.json();
        if (data && data.data) {
          showResult('‚úÖ Short link deleted successfully.');
          localStorage.removeItem('lastShortLink');
          // also remove from history if present
          removeFromHistoryById(linkId);
        } else {
          showError('‚ùå ' + JSON.stringify(data));
        }

      } catch (error) {
        console.error(error);
        showError('Delete request failed.');
      }
    }

    // ===== History: add / render / load =====
    function addToHistory(link) {
      let history = JSON.parse(localStorage.getItem('linkHistory')) || [];
      // keep newest first and prevent duplicates
      history = history.filter(l => l !== link);
      history.unshift(link);
      // keep only recent 50
      if (history.length > 50) history = history.slice(0, 50);
      localStorage.setItem('linkHistory', JSON.stringify(history));
      renderHistory();
    }

    function loadHistory() {
      renderHistory();
    }

    function renderHistory() {
      const history = JSON.parse(localStorage.getItem('linkHistory')) || [];
      const list = document.getElementById('historyList');
      list.innerHTML = '';
      if (!history.length) {
        list.innerHTML = '<li style="color:rgba(0,0,0,0.6)">No links yet ‚Äî shorten one to get started.</li>';
        return;
      }
      history.forEach(link => {
        const li = document.createElement('li');
        li.innerHTML = `<a href="${link}" target="_blank" rel="noopener">${link}</a>`;
        list.appendChild(li);
      });
    }

    function removeFromHistoryById(linkId) {
      // tinyurl delete returns id, but our local history stores only urls.
      // We'll just clear lastShortLink and re-render (user can clear history manually)
      localStorage.removeItem('lastShortLink');
      // You could optionally remove items matching the deleted link if you store IDs in history.
      renderHistory();
    }

    // ===== Load last short link on page load =====
    function loadLastResult() {
      try {
        const last = JSON.parse(localStorage.getItem('lastShortLink'));
        if (last && last.url) {
          showResult(last.url, last.id);
        }
      } catch (e) {
        console.error('Failed to parse lastShortLink', e);
      }
    }

    // ===== QR Scanner (html5-qrcode) =====
    function openScanner() {
      // show modal
      const modal = document.getElementById('scannerModal');
      modal.style.display = 'flex';

      // clear previous reader if exists
      document.getElementById('qr-reader').innerHTML = '';

      try {
        html5QrCode = new Html5Qrcode("qr-reader");
        Html5Qrcode.getCameras().then(devices => {
          if (devices && devices.length) {
            const cameraId = devices[0].id;
            html5QrCode.start(
              cameraId,
              { fps: 10, qrbox: 250 },
              qrCodeMessage => {
                alert(`Scanned: ${qrCodeMessage}`);
                try { window.open(qrCodeMessage, '_blank'); } catch(e){ /* ignore */ }
                closeScanner();
              },
              errorMessage => {
                // scanning error (non-fatal)
                // console.log('scan error', errorMessage);
              }
            ).catch(err => {
              console.error('QR start failed', err);
              alert('Could not start QR camera. Check permissions.');
              closeScanner();
            });
          } else {
            alert('No camera devices found.');
            closeScanner();
          }
        }).catch(err => {
          console.error('Camera access error', err);
          alert('Unable to access cameras.');
          closeScanner();
        });
      } catch (err) {
        console.error('Scanner init error', err);
        alert('Scanner initialization failed.');
        closeScanner();
      }
    }

    function closeScanner() {
      // stop scanner safely
      try {
        if (html5QrCode) {
          html5QrCode.stop().then(() => {
            try { html5QrCode.clear(); } catch(e){/* ignore */ }
            html5QrCode = null;
          }).catch(err => {
            console.error('Error stopping scanner', err);
            html5QrCode = null;
          });
        }
      } catch (e) {
        console.error(e);
      }
      // hide modal
      const modal = document.getElementById('scannerModal');
      modal.style.display = 'none';
    }

    // ensure scanner stops if user navigates away/unloads
    window.addEventListener('beforeunload', () => {
      if (html5QrCode) {
        try { html5QrCode.stop(); } catch(e){ /* ignore */ }
      }
    });
  </script>
</body>
</html> -->












<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ultimate TinyURL Clone üöÄ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #ffffff; /* White background as requested */
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 40px 20px;
  color: #000; /* Black text for contrast */
  box-sizing: border-box;
}

/* Keep your original heading size and alignment, but blue color */
h1 {
  margin-bottom: 20px;
  font-size: 2.2rem;
  text-align: center;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.03);
  color: #1e3c72; /* blue heading */
}

/* Inputs: same sizes you used, with blue borders/highlight */
input {
  padding: 14px 16px;
  margin: 10px 0;
  width: 100%;
  max-width: 450px;
  border-radius: 8px;
  border: 2px solid #1e3c72; /* blue border */
  outline: none;
  font-size: 1rem;
  transition: box-shadow 0.3s ease, border-color 0.2s ease;
  box-sizing: border-box;
  background: #fff;
  color: #000;
}

input::placeholder { color: rgba(0,0,0,0.45); }

input:focus {
  box-shadow: 0 0 10px rgba(0, 114, 255, 0.15);
  border-color: #0072ff;
}

/* Buttons: keep your rounded style with blue gradient */
button {
  padding: 14px 30px;
  margin: 12px 5px;
  background: linear-gradient(to right, #00c6ff, #0072ff);
  color: #fff;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  font-size: 1rem;
  position: relative;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  width: 100%;
  max-width: 220px;
}

button::before {
  content: '';
  position: absolute;
  top: 0; left: -75%;
  width: 50%;
  height: 100%;
  background: rgba(255, 255, 255, 0.3);
  transform: skewX(-20deg);
  transition: left 0.5s ease;
}

button:hover::before {
  left: 125%;
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 25px rgba(0,0,0,0.08);
}

/* Result box: white-ish with blue border */
#result {
  margin-top: 30px;
  background: #ffffff;
  color: #000;
  padding: 20px;
  border-radius: 12px;
  width: 100%;
  max-width: 500px;
  text-align: center;
  display: none;
  animation: fadeInUp 0.6s ease forwards;
  word-wrap: break-word;
  border: 2px solid #1e3c72; /* blue border */
}

#qrcode {
  margin-top: 15px;
}

/* History: keep original look but white + blue accents */
#history {
  margin-top: 30px;
  background: #ffffff;
  color: #000;
  padding: 20px;
  border-radius: 12px;
  width: 100%;
  max-width: 500px;
  word-wrap: break-word;
  border: 2px solid rgba(30,60,114,0.08);
}

#history h3 { color: #1e3c72; margin-top: 0; }

#historyList a {
  display: block;
  color: #0072ff;
  text-decoration: none;
  margin: 5px 0;
  transition: color 0.3s;
  word-break: break-all;
}

#historyList a:hover {
  color: #005ec3;
}

/* Error box */
.error {
  background: #ff4e50;
  color: #fff;
  padding: 14px;
  border-radius: 8px;
  margin-top: 10px;
  animation: shake 0.4s;
}

/* Progress bar (subtle blue) */
.progress-bar {
  position: relative;
  width: 100%;
  max-width: 500px;
  height: 5px;
  background: rgba(0, 114, 255, 0.08);
  overflow: hidden;
  border-radius: 5px;
  margin-top: 20px;
}

.progress-bar::before {
  content: '';
  position: absolute;
  left: -40%;
  width: 40%;
  height: 100%;
  background: #00c6ff;
  animation: loading 1.5s linear infinite;
}

/* Keyframes */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}
@keyframes loading {
  0% { left: -40%; }
  100% { left: 100%; }
}

/* Modal (scanner) styles - keep white modal content but dark overlay */
.modal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  align-items: center;
  justify-content: center;
  padding: 20px;
  box-sizing: border-box;
}

.modal-content {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  position: relative;
  width: 100%;
  max-width: 500px;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  background: #0072ff;
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 35px; height: 35px;
  cursor: pointer;
  font-size: 1rem;
}

/* Responsive tweaks (mobile/tablet) while keeping desktop alignment same */
@media (max-width: 900px) {
  body { padding: 24px 16px; }
  h1 { font-size: 1.9rem; }
  input, #result, #history, .modal-content { width: 100%; max-width: 100%; }
  button { width: 100%; max-width: 100%; margin: 8px 0; }
  #qr-reader { width: 100% !important; }
}

@media (max-width: 420px) {
  h1 { font-size: 1.6rem; margin-bottom: 14px; }
  input { padding: 12px 12px; font-size: 0.95rem; }
  button { padding: 12px 16px; font-size: 0.95rem; }
}
  </style>
</head>
<body>
  <h1>üîó Ultimate TinyURL Clone</h1>


  <input type="url" id="longUrl" placeholder="Enter long URL"><br>
  <input type="text" id="customAlias" placeholder="Custom alias (min 5 chars)"><br>

  <button onclick="shortenUrl()">Shorten URL</button>
  <button onclick="openScanner()">Scan QR</button>

  <div id="result"></div>

  <div id="history">
    <h3>üîñ Your Links</h3>
    <ul id="historyList"></ul>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>

  <div id="scannerModal" class="modal" role="dialog" aria-hidden="true">
    <div class="modal-content">
      <button class="close-btn" onclick="closeScanner()">‚úñ</button>
      <div id="qr-reader" style="width: 400px; max-width:100%;"></div>
    </div>
  </div>

  <script>
    
   const apiKey = 'fvTV9xRf9HfXijy4MgMOhR0kCBvyxcd7WLBPCCWPQlPkcxeDBrWoZnqdY0TF';
let html5QrCode = null;

document.addEventListener('DOMContentLoaded', () => {
  loadLastResult();
  loadHistory();
});

async function shortenUrl() {
  const longUrl = document.getElementById('longUrl').value.trim();
  const customAlias = document.getElementById('customAlias').value.trim();

  if (!longUrl) {
    showError('Please enter a valid URL.');
    return;
  }

  if (customAlias && customAlias.length < 5) {
    showError('Custom alias must be at least 5 characters.');
    return;
  }

  const requestData = { url: longUrl };
  if (customAlias) {
    requestData.domain = 'tiny.one';
    requestData.alias = customAlias;
  }

  showResult('‚è≥ Shortening...');

  try {
    const res = await fetch('https://api.tinyurl.com/create', {
      method: 'POST',
      headers: {
        'accept': 'application/json',
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify(requestData)
    });

    const data = await res.json();

    if (data && data.data && data.data.tiny_url) {
      const shortLink = data.data.tiny_url;
      const linkId = data.data.id_string || null;

      // Save last result
      localStorage.setItem('lastShortLink', JSON.stringify({ url: shortLink, id: linkId }));

      // Add to history (store both URL and ID)
      addToHistory(shortLink, linkId);

      // Show result with QR
      showResult(shortLink, linkId);
    } else {
      const msg = (data && data.errors && data.errors.length) ? data.errors[0].message : 'Something went wrong.';
      showError('‚ùå ' + msg);
    }

  } catch (error) {
    console.error(error);
    showError('Request failed.');
  }
}

// ===== UI: showResult / showError =====
function showResult(link, id) {
  const result = document.getElementById('result');
  result.style.display = 'block';

  if (typeof link === 'string' && link.startsWith('http')) {
    result.innerHTML = `
      ‚úÖ Short URL: <a href="${link}" target="_blank" rel="noopener">${link}</a><br>
      <button onclick="copyToClipboard('${link}')">üìã Copy</button>
      <div id="qrcode"></div><br>
      <button onclick="deleteLink('${id}')">üóëÔ∏è Delete Link</button>
    `;
    const qrEl = document.getElementById("qrcode");
    if (qrEl) { qrEl.innerHTML = ''; try { new QRCode(qrEl, link); } catch (e) { console.error(e); } }
  } else {
    result.innerHTML = `<div style="color:#333">${link}</div>`;
  }
}

function showError(message) {
  const result = document.getElementById('result');
  result.style.display = 'block';
  result.innerHTML = `<div class="error">${message}</div>`;
}

// ===== Copy to clipboard =====
function copyToClipboard(text) {
  if (!navigator.clipboard) {
    alert('Clipboard not supported.');
    return;
  }
  navigator.clipboard.writeText(text).then(() => {
    alert('Copied to clipboard!');
  }).catch(err => {
    console.error(err);
    alert('Copy failed.');
  });
}

// ===== Delete link via TinyURL API =====
async function deleteLink(linkId) {
  if (!linkId) {
    alert('No link ID found to delete.');
    return;
  }

  showResult('‚è≥ Deleting...');

  try {
    const res = await fetch(`https://api.tinyurl.com/delete`, {
      method: 'DELETE',
      headers: {
        'accept': 'application/json',
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify({ id: linkId })
    });

    const data = await res.json();
    if (data && data.data) {
      showResult('‚úÖ Short link deleted successfully.');
      removeFromHistoryById(linkId);
      localStorage.removeItem('lastShortLink');
    } else {
      showError('‚ùå ' + JSON.stringify(data));
    }

  } catch (error) {
    console.error(error);
    showError('Delete request failed.');
  }
}

// ===== History: add / render / load =====
function addToHistory(link, linkId) {
  let history = JSON.parse(localStorage.getItem('linkHistory')) || [];
  history = history.filter(l => l.id !== linkId); // remove duplicates
  history.unshift({ url: link, id: linkId });
  if (history.length > 50) history = history.slice(0, 50);
  localStorage.setItem('linkHistory', JSON.stringify(history));
  renderHistory();
}

function loadHistory() {
  renderHistory();
}

function renderHistory() {
  const history = JSON.parse(localStorage.getItem('linkHistory')) || [];
  const list = document.getElementById('historyList');
  list.innerHTML = '';
  if (!history.length) {
    list.innerHTML = '<li style="color:rgba(0,0,0,0.6)">No links yet ‚Äî shorten one to get started.</li>';
    return;
  }
  history.forEach(item => {
    const li = document.createElement('li');
    li.innerHTML = `
      <a href="${item.url}" target="_blank" rel="noopener">${item.url}</a>
      <button onclick="deleteLink('${item.id}')">üóëÔ∏è Delete</button>
    `;
    list.appendChild(li);
  });
}

function removeFromHistoryById(linkId) {
  let history = JSON.parse(localStorage.getItem('linkHistory')) || [];
  history = history.filter(item => item.id !== linkId);
  localStorage.setItem('linkHistory', JSON.stringify(history));
  renderHistory();
}

// ===== Load last short link on page load =====
function loadLastResult() {
  try {
    const last = JSON.parse(localStorage.getItem('lastShortLink'));
    if (last && last.url) {
      showResult(last.url, last.id);
    }
  } catch (e) {
    console.error('Failed to parse lastShortLink', e);
  }
}

// ===== QR Scanner =====
function openScanner() {
  const modal = document.getElementById('scannerModal');
  modal.style.display = 'flex';
  document.getElementById('qr-reader').innerHTML = '';

  try {
    html5QrCode = new Html5Qrcode("qr-reader");
    Html5Qrcode.getCameras().then(devices => {
      if (devices && devices.length) {
        const cameraId = devices[0].id;
        html5QrCode.start(
          cameraId,
          { fps: 10, qrbox: 250 },
          qrCodeMessage => {
            alert(`Scanned: ${qrCodeMessage}`);
            try { window.open(qrCodeMessage, '_blank'); } catch(e){ }
            closeScanner();
          },
          errorMessage => {}
        ).catch(err => {
          console.error('QR start failed', err);
          alert('Could not start QR camera.');
          closeScanner();
        });
      } else {
        alert('No camera devices found.');
        closeScanner();
      }
    }).catch(err => {
      console.error('Camera access error', err);
      alert('Unable to access cameras.');
      closeScanner();
    });
  } catch (err) {
    console.error('Scanner init error', err);
    alert('Scanner initialization failed.');
    closeScanner();
  }
}

function closeScanner() {
  try {
    if (html5QrCode) {
      html5QrCode.stop().then(() => {
        try { html5QrCode.clear(); } catch(e){ }
        html5QrCode = null;
      }).catch(err => { html5QrCode = null; });
    }
  } catch (e) { console.error(e); }
  document.getElementById('scannerModal').style.display = 'none';
}

window.addEventListener('beforeunload', () => {
  if (html5QrCode) try { html5QrCode.stop(); } catch(e){ }
});

  </script>
</body>
</html>